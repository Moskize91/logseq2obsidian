#!/usr/bin/env python3
"""
é¡µé¢é“¾æ¥è½¬æ¢çš„è¾¹ç¼˜æƒ…å†µæµ‹è¯•å¥—ä»¶
ç¡®ä¿å„ç§æ ¼å¼çš„é¡µé¢é“¾æ¥éƒ½èƒ½æ­£ç¡®å¤„ç†
"""

import sys
from pathlib import Path

# æ·»åŠ  src ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, str(Path(__file__).parent / 'src'))

from obsidian_formatter import ObsidianFormatter


def test_page_link_edge_cases():
    """æµ‹è¯•é¡µé¢é“¾æ¥è½¬æ¢çš„å„ç§è¾¹ç¼˜æƒ…å†µ"""
    formatter = ObsidianFormatter()
    
    # è¾¹ç¼˜æƒ…å†µæµ‹è¯•é›†
    edge_cases = [
        # åŸºæœ¬é¡µé¢é“¾æ¥
        ("[[æ–¹æµå„ä¼š]]", "[[æ–¹æµå„ä¼š]]", "ä¸­æ–‡é¡µé¢é“¾æ¥"),
        ("[[ä½›æ•™]]", "[[ä½›æ•™]]", "ä¸­æ–‡å•å­—é¡µé¢é“¾æ¥"),
        ("[[Buddhism]]", "[[Buddhism]]", "è‹±æ–‡é¡µé¢é“¾æ¥"),
        
        # åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„é¡µé¢é“¾æ¥
        ("[[React.js]]", "[[React.js]]", "å¸¦ç‚¹å·çš„é¡µé¢é“¾æ¥"),
        ("[[C++]]", "[[C++]]", "å¸¦åŠ å·çš„é¡µé¢é“¾æ¥"),
        ("[[Web3.0]]", "[[Web3.0]]", "å¸¦æ•°å­—çš„é¡µé¢é“¾æ¥"),
        ("[[Test-Case]]", "[[Test-Case]]", "å¸¦è¿å­—ç¬¦çš„é¡µé¢é“¾æ¥"),
        ("[[Test_Case]]", "[[Test_Case]]", "å¸¦ä¸‹åˆ’çº¿çš„é¡µé¢é“¾æ¥"),
        ("[[Test Space]]", "[[Test Space]]", "å¸¦ç©ºæ ¼çš„é¡µé¢é“¾æ¥"),
        
        # åŒ…å«ä¸­è‹±æ··åˆçš„é¡µé¢é“¾æ¥
        ("[[Traditional Chinese Medicine]]", "[[Traditional Chinese Medicine]]", "è‹±æ–‡è¯ç»„é¡µé¢é“¾æ¥"),
        ("[[è®¡ç®—æœºç§‘å­¦Computer Science]]", "[[è®¡ç®—æœºç§‘å­¦Computer Science]]", "ä¸­è‹±æ··åˆé¡µé¢é“¾æ¥"),
        ("[[AIäººå·¥æ™ºèƒ½]]", "[[AIäººå·¥æ™ºèƒ½]]", "è‹±æ–‡ç¼©å†™+ä¸­æ–‡"),
        
        # æ–‡æœ¬ä¸­çš„é¡µé¢é“¾æ¥
        ("è¿™é‡Œæœ‰ä¸ªé“¾æ¥ [[æµ‹è¯•é¡µé¢]] åœ¨æ–‡æœ¬ä¸­", "è¿™é‡Œæœ‰ä¸ªé“¾æ¥ [[æµ‹è¯•é¡µé¢]] åœ¨æ–‡æœ¬ä¸­", "æ–‡æœ¬ä¸­çš„é¡µé¢é“¾æ¥"),
        ("å¤šä¸ªé“¾æ¥ï¼š[[é¡µé¢1]] å’Œ [[é¡µé¢2]]", "å¤šä¸ªé“¾æ¥ï¼š[[é¡µé¢1]] å’Œ [[é¡µé¢2]]", "ä¸€è¡Œä¸­çš„å¤šä¸ªé¡µé¢é“¾æ¥"),
        ("- [[ä»»åŠ¡1]] è¿™æ˜¯ä¸€ä¸ªä»»åŠ¡", "- [[ä»»åŠ¡1]] è¿™æ˜¯ä¸€ä¸ªä»»åŠ¡", "åˆ—è¡¨é¡¹ä¸­çš„é¡µé¢é“¾æ¥"),
        
        # å¸¦æœ‰ç‰¹æ®Šç¬¦å·çš„è¾¹ç¼˜æƒ…å†µ
        ("[[#æ ‡ç­¾é¡µé¢]]", "[[#æ ‡ç­¾é¡µé¢]]", "å¸¦äº•å·çš„é¡µé¢é“¾æ¥"),
        ("[[@æåŠé¡µé¢]]", "[[@æåŠé¡µé¢]]", "å¸¦@ç¬¦å·çš„é¡µé¢é“¾æ¥"),
        ("[[50%]]", "[[50%]]", "å¸¦ç™¾åˆ†å·çš„é¡µé¢é“¾æ¥"),
        ("[[2023å¹´]]", "[[2023å¹´]]", "å¸¦å¹´ä»½çš„é¡µé¢é“¾æ¥"),
        
        # å¯èƒ½ä¸æ ‡ç­¾æ··æ·†çš„æƒ…å†µ
        ("[[ç¼–ç¨‹è¯­è¨€]]", "[[ç¼–ç¨‹è¯­è¨€]]", "æ¦‚å¿µè¯æ±‡é¡µé¢é“¾æ¥"),
        ("[[æœºå™¨å­¦ä¹ ]]", "[[æœºå™¨å­¦ä¹ ]]", "æŠ€æœ¯æ¦‚å¿µé¡µé¢é“¾æ¥"),
        ("[[ç®—æ³•]]", "[[ç®—æ³•]]", "å­¦æœ¯æ¦‚å¿µé¡µé¢é“¾æ¥"),
        ("[[æ•°æ®ç»“æ„]]", "[[æ•°æ®ç»“æ„]]", "è®¡ç®—æœºç§‘å­¦æ¦‚å¿µ"),
        
        # æ··åˆæ ¼å¼çš„å¤æ‚æƒ…å†µ  
        ("åœ¨ [[React.js]] ä¸­ä½¿ç”¨ [[TypeScript]] å¼€å‘", "åœ¨ [[React.js]] ä¸­ä½¿ç”¨ [[TypeScript]] å¼€å‘", "æŠ€æœ¯åè¯é¡µé¢é“¾æ¥"),
        ("å­¦ä¹  [[Python]] å’Œ [[æœºå™¨å­¦ä¹ ]] çš„åŸºç¡€", "å­¦ä¹  [[Python]] å’Œ [[æœºå™¨å­¦ä¹ ]] çš„åŸºç¡€", "æŠ€æœ¯+æ¦‚å¿µæ··åˆ"),
        
        # ç©ºç™½å’Œæ ¼å¼è¾¹ç¼˜æƒ…å†µ
        ("[[]]", "[[]]", "ç©ºé¡µé¢é“¾æ¥"),
        ("[[  ]]", "[[  ]]", "åªæœ‰ç©ºæ ¼çš„é¡µé¢é“¾æ¥"),
        ("å‰é¢æ–‡å­—[[é¡µé¢]]åé¢æ–‡å­—", "å‰é¢æ–‡å­—[[é¡µé¢]]åé¢æ–‡å­—", "ç´§è´´æ–‡å­—çš„é¡µé¢é“¾æ¥"),
        
        # åµŒå¥—æƒ…å†µ
        ("å‚è€ƒ [[å…³äº[[åµŒå¥—]]çš„è®¨è®º]]", "å‚è€ƒ [[å…³äº[[åµŒå¥—]]çš„è®¨è®º]]", "åµŒå¥—é“¾æ¥æƒ…å†µ"),
        
        # é•¿é¡µé¢åç§°
        ("[[è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„é¡µé¢åç§°ç”¨äºæµ‹è¯•è¾¹ç¼˜æƒ…å†µ]]", "[[è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„é¡µé¢åç§°ç”¨äºæµ‹è¯•è¾¹ç¼˜æƒ…å†µ]]", "é•¿é¡µé¢åç§°"),
        
        # æ•°å­—å’Œç¬¦å·ç»„åˆ
        ("[[IPv4]]", "[[IPv4]]", "æŠ€æœ¯æœ¯è¯­å¸¦æ•°å­—"),
        ("[[HTTP/2]]", "[[HTTP/2]]", "å¸¦æ–œæ çš„æŠ€æœ¯æœ¯è¯­"),
        ("[[REST API]]", "[[REST API]]", "æŠ€æœ¯ç¼©å†™"),
    ]
    
    print("æµ‹è¯•é¡µé¢é“¾æ¥è½¬æ¢çš„è¾¹ç¼˜æƒ…å†µ...")
    print("=" * 70)
    
    passed = 0
    failed = 0
    
    for i, (input_text, expected_output, description) in enumerate(edge_cases, 1):
        try:
            result = formatter._convert_page_links(input_text)
            
            if result == expected_output:
                print(f"âœ“ æµ‹è¯• {i:2d}: {description}")
                passed += 1
            else:
                print(f"âœ— æµ‹è¯• {i:2d}: {description}")
                print(f"     è¾“å…¥: {input_text}")
                print(f"     æœŸæœ›: {expected_output}")
                print(f"     å®é™…: {result}")
                failed += 1
                
        except (AttributeError, ValueError, TypeError) as e:
            print(f"âœ— æµ‹è¯• {i:2d}: {description} - å¼‚å¸¸: {e}")
            failed += 1
    
    print("=" * 70)
    print(f"æµ‹è¯•ç»“æœ: {passed} é€šè¿‡, {failed} å¤±è´¥")
    
    if failed == 0:
        print("ğŸ‰ æ‰€æœ‰è¾¹ç¼˜æƒ…å†µæµ‹è¯•é€šè¿‡ï¼é¡µé¢é“¾æ¥è½¬æ¢åŠŸèƒ½å®Œå…¨æ­£å¸¸")
        return True
    else:
        print(f"âŒ {failed} ä¸ªæµ‹è¯•å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥ä»£ç ")
        return False


if __name__ == "__main__":
    test_page_link_edge_cases()